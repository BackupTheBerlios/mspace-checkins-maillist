<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mspace-checkins] r402 - in ComponentModel/trunk: ComponentTest/lib ComponentTest/src ComponentTest/src/Components/MainComponent/Bo ComponentTest/src/Components/Saludator ComponentTest/src/Components/Saludator/Bo ComponentTest/src/Components/Saludator/Form lib src src/ComponentModel.Container src/ComponentModel.Interfaces src/ComponentModel.VO
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/mspace-checkins/2005-April/index.html" >
   <LINK REL="made" HREF="mailto:mspace-checkins%40lists.berlios.de?Subject=Re%3A%20%5BMspace-checkins%5D%20r402%20-%20in%20ComponentModel/trunk%3A%20ComponentTest/lib%20ComponentTest/src%20ComponentTest/src/Components/MainComponent/Bo%20ComponentTest/src/Components/Saludator%20ComponentTest/src/Components/Saludator/Bo%20ComponentTest/src/Components/Saludator/Form%20lib%20src%20src/ComponentModel.Container%20src/ComponentModel.Interfaces%20src/ComponentModel.VO&In-Reply-To=%3C200504052130.j35LUYHE008006%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000114.html">
   <LINK REL="Next"  HREF="000116.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mspace-checkins] r402 - in ComponentModel/trunk: ComponentTest/lib ComponentTest/src ComponentTest/src/Components/MainComponent/Bo ComponentTest/src/Components/Saludator ComponentTest/src/Components/Saludator/Bo ComponentTest/src/Components/Saludator/Form lib src src/ComponentModel.Container src/ComponentModel.Interfaces src/ComponentModel.VO</H1>
    <B>N&#233;stor Salceda at BerliOS</B> 
    <A HREF="mailto:mspace-checkins%40lists.berlios.de?Subject=Re%3A%20%5BMspace-checkins%5D%20r402%20-%20in%20ComponentModel/trunk%3A%20ComponentTest/lib%20ComponentTest/src%20ComponentTest/src/Components/MainComponent/Bo%20ComponentTest/src/Components/Saludator%20ComponentTest/src/Components/Saludator/Bo%20ComponentTest/src/Components/Saludator/Form%20lib%20src%20src/ComponentModel.Container%20src/ComponentModel.Interfaces%20src/ComponentModel.VO&In-Reply-To=%3C200504052130.j35LUYHE008006%40sheep.berlios.de%3E"
       TITLE="[Mspace-checkins] r402 - in ComponentModel/trunk: ComponentTest/lib ComponentTest/src ComponentTest/src/Components/MainComponent/Bo ComponentTest/src/Components/Saludator ComponentTest/src/Components/Saludator/Bo ComponentTest/src/Components/Saludator/Form lib src src/ComponentModel.Container src/ComponentModel.Interfaces src/ComponentModel.VO">nestor at sheep.berlios.de
       </A><BR>
    <I>Tue Apr  5 23:30:34 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000114.html">[Mspace-checkins] r401 - Red.ProjectManager/trunk
</A></li>
        <LI>Next message: <A HREF="000116.html">[Mspace-checkins] r403 - in ComponentModel/trunk: ComponentTest/src/Components/MainComponent ComponentTest/src/Components/MainComponent/Bo ComponentTest/src/Components/MainComponent/Exception ComponentTest/src/Components/Saludator/Bo ComponentTest/src/Components/Saludator/Exception src src/ComponentModel.Container src/ComponentModel.Exceptions src/ComponentModel.Interfaces src/ComponentModel.VO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#115">[ date ]</a>
              <a href="thread.html#115">[ thread ]</a>
              <a href="subject.html#115">[ subject ]</a>
              <a href="author.html#115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: nestor
Date: 2005-04-05 23:30:32 +0200 (Tue, 05 Apr 2005)
New Revision: 402

Added:
   ComponentModel/trunk/ComponentTest/lib/NLog.dll
   ComponentModel/trunk/ComponentTest/lib/NLog.dll.nlog
   ComponentModel/trunk/ComponentTest/src/Components/Saludator/Form/
   ComponentModel/trunk/ComponentTest/src/Components/Saludator/Form/SaludatorForm.cs
   ComponentModel/trunk/lib/NLog.dll
   ComponentModel/trunk/lib/NLog.dll.nlog
   ComponentModel/trunk/src/ComponentModel.VO/ResponseMethodVO.cs
Modified:
   ComponentModel/trunk/ComponentTest/src/Components/MainComponent/Bo/MainComponentComponentModel.cs
   ComponentModel/trunk/ComponentTest/src/Components/Saludator/Bo/SaludatorComponentModel.cs
   ComponentModel/trunk/ComponentTest/src/Launcher.cs
   ComponentModel/trunk/src/ComponentModel.Container/DefaultContainer.cs
   ComponentModel/trunk/src/ComponentModel.Interfaces/IComponentModel.cs
   ComponentModel/trunk/src/ComponentModel.Interfaces/IContainer.cs
   ComponentModel/trunk/src/DefaultComponentModel.cs
Log:
Version Pre-Alpha.

Initial funtional prototype for ComponentModel.

Exception Control not supported yet.
Component call executor supported.
Initial loading components supported.



Added: ComponentModel/trunk/ComponentTest/lib/NLog.dll
===================================================================
--- ComponentModel/trunk/ComponentTest/lib/NLog.dll	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/ComponentTest/lib/NLog.dll	2005-04-05 21:30:32 UTC (rev 402)
@@ -0,0 +1 @@
+link ../../lib/NLog.dll
\ No newline at end of file


Property changes on: ComponentModel/trunk/ComponentTest/lib/NLog.dll
___________________________________________________________________
Name: svn:special
   + *

Added: ComponentModel/trunk/ComponentTest/lib/NLog.dll.nlog
===================================================================
--- ComponentModel/trunk/ComponentTest/lib/NLog.dll.nlog	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/ComponentTest/lib/NLog.dll.nlog	2005-04-05 21:30:32 UTC (rev 402)
@@ -0,0 +1,8 @@
+&lt;nlog&gt;
+	&lt;appenders&gt;
+            &lt;appender name=&quot;debug&quot;  type=&quot;Console&quot; /&gt;
+        &lt;/appenders&gt;
+	&lt;rules&gt;
+		&lt;logger name=&quot;*&quot; levels=&quot;Info,Warn,Debug&quot; appendTo=&quot;debug&quot;/&gt;
+	&lt;/rules&gt;
+&lt;/nlog&gt;

Modified: ComponentModel/trunk/ComponentTest/src/Components/MainComponent/Bo/MainComponentComponentModel.cs
===================================================================
--- ComponentModel/trunk/ComponentTest/src/Components/MainComponent/Bo/MainComponentComponentModel.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/ComponentTest/src/Components/MainComponent/Bo/MainComponentComponentModel.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -1,7 +1,7 @@
 using System;
 using ComponentModel;
 
-namespace ComponentModel.ComponentTest.MainComponent.Bo {
+namespace ComponentModel.ComponentTest.Components.MainComponent.Bo {
     [Component (ComponentName=&quot;MainComponent&quot;, ExceptionManager=&quot;ComponentModel.ComponentTest.MainComponent.Exception.MainComponentExceptionManager&quot;)]
     public class MainComponentComponentModel : DefaultComponentModel {
     }

Modified: ComponentModel/trunk/ComponentTest/src/Components/Saludator/Bo/SaludatorComponentModel.cs
===================================================================
--- ComponentModel/trunk/ComponentTest/src/Components/Saludator/Bo/SaludatorComponentModel.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/ComponentTest/src/Components/Saludator/Bo/SaludatorComponentModel.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -1,14 +1,17 @@
 using System;
 using ComponentModel;
 
-namespace ComponentModel.ComponentTest.Saludator.Bo {
-   [Component (ComponentName=&quot;Saludator&quot;, ExceptionManager=&quot;ComponentModel.ComponentText.Saludator.Exception.SaludatorExceptionManager&quot;)] 
+namespace ComponentModel.ComponentTest.Components.Saludator.Bo {
+   [Component (ComponentName=&quot;Saludator&quot;, ExceptionManager=&quot;ComponentModel.ComponentTest.Components.Saludator.Exception.SaludatorExceptionManager&quot;)] 
    public sealed class SaludatorComponentModel : DefaultComponentModel {
        public SaludatorComponentModel () : base () {
        }
 
-       [ComponentMethod (ViewName = &quot;ComponentModel.ComponentTest.Saludator.Form.SaludatorForm&quot;, ResponseName = &quot;ResponseSaluda&quot;)]
-       public void Saluda () {
+       //ComponentModel.ComponentTest.Components.Saludator.Form.SaludatorForm
+       [ComponentMethod (ViewName = &quot;ComponentModel.ComponentTest.Components.Saludator.Form.SaludatorForm&quot;, ResponseName = &quot;ResponseSaluda&quot;)]
+       public int Saluda () {
+           Console.WriteLine (&quot;Que pasa co !!&quot;);
+           return 1;
        }
    }
 }

Added: ComponentModel/trunk/ComponentTest/src/Components/Saludator/Form/SaludatorForm.cs
===================================================================
--- ComponentModel/trunk/ComponentTest/src/Components/Saludator/Form/SaludatorForm.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/ComponentTest/src/Components/Saludator/Form/SaludatorForm.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -0,0 +1,15 @@
+using System;
+using ComponentModel;
+using ComponentModel.VO;
+
+namespace ComponentModel.ComponentTest.Components.Saludator.Form {
+    public class SaludatorForm {
+        public SaludatorForm () {
+        }
+        
+        public void ResponseSaluda (ResponseMethodVO response) {
+            Console.WriteLine (&quot;Response hola !!&quot;);
+            Console.WriteLine ((int)response.ResponseValue);
+        }
+    }
+}

Modified: ComponentModel/trunk/ComponentTest/src/Launcher.cs
===================================================================
--- ComponentModel/trunk/ComponentTest/src/Launcher.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/ComponentTest/src/Launcher.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -1,4 +1,5 @@
 using System;
+using System.Diagnostics;
 using System.Reflection;
 using ComponentModel.Container;
 
@@ -7,6 +8,13 @@
         public static void Main () {
             DefaultContainer defaultContainer = DefaultContainer.Instance; 
         //    Console.WriteLine (Assembly.GetExecutingAssembly ().FullName);
+            DefaultComponentModel dcm = (DefaultComponentModel)defaultContainer.GetComponentByName (&quot;Saludator&quot;);
+            Debug.Assert (dcm != null);
+            if (dcm != null)
+                Console.WriteLine (&quot;Dcm no es null&quot;);
+            else
+                Console.WriteLine (&quot;Dcm es null&quot;);
+            dcm.Execute (&quot;Saluda&quot;, null);
         }
     }
 }

Added: ComponentModel/trunk/lib/NLog.dll
===================================================================
(Binary files differ)


Property changes on: ComponentModel/trunk/lib/NLog.dll
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: ComponentModel/trunk/lib/NLog.dll.nlog
===================================================================
--- ComponentModel/trunk/lib/NLog.dll.nlog	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/lib/NLog.dll.nlog	2005-04-05 21:30:32 UTC (rev 402)
@@ -0,0 +1,8 @@
+&lt;nlog&gt;
+	&lt;appenders&gt;
+            &lt;appender name=&quot;debug&quot;  type=&quot;Console&quot; /&gt;
+        &lt;/appenders&gt;
+	&lt;rules&gt;
+		&lt;logger name=&quot;*&quot; levels=&quot;Info,Warn,Debug&quot; appendTo=&quot;debug&quot;/&gt;
+	&lt;/rules&gt;
+&lt;/nlog&gt;

Modified: ComponentModel/trunk/src/ComponentModel.Container/DefaultContainer.cs
===================================================================
--- ComponentModel/trunk/src/ComponentModel.Container/DefaultContainer.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/src/ComponentModel.Container/DefaultContainer.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -4,20 +4,36 @@
 using System.Collections;
 using ComponentModel.Interfaces;
 using ComponentModel.Container.Dao;
+using NLog;
 
 namespace ComponentModel.Container {
     public class DefaultContainer : IContainer {
         private static DefaultContainer instance = null; 
-       
+        private Assembly[] assemblies; 
         private IList componentList;
         
+        //Logging
+        Logger logger = LogManager.GetLogger (&quot;ComponentModel.Container.DefaultContainer&quot;);
+        
+        internal Assembly[] Assemblies {
+            get {
+                return assemblies;
+            }
+        }
+        
         private DefaultContainer () {
+            logger.Debug (&quot;Init DefaultContainer&quot;);
             componentList = new ArrayList ();
             //Toma el &#250;nico dominio de la aplicacion
             AppDomain appDomain = AppDomain.CurrentDomain;
-            Assembly[] assemblies = appDomain.GetAssemblies ();
+            assemblies = appDomain.GetAssemblies ();
             foreach (Assembly ass  in assemblies) {
                 ICollection collection = DefaultContainerDao.Instance.ProcessAssembly (ass);
+                //DEbugg
+                //foreach (Type type in ass.GetTypes ()) {
+                //    logger.Debug (&quot;Type finded: &quot; + type.ToString ());
+                //}
+                //
                 RegisterComponent (collection);
             }
             //En cada ensamblado, cargar&#225; el / los componente y lo registrar&#225; con el
@@ -30,8 +46,6 @@
             while (enumerator.MoveNext ()) {
                 DefaultComponentModel defaultComponentModel = (DefaultComponentModel)enumerator.Current;
                 this.Add (defaultComponentModel); 
-                Console.WriteLine (&quot;Added: &quot; + defaultComponentModel.ToString ());
-                Console.WriteLine (defaultComponentModel.VO.Name);
             }
         }
         
@@ -57,6 +71,7 @@
             if (componentList.Contains (component))
                 return;
             componentList.Add (component);
+            logger.Debug (&quot;Registering component: &quot; + component + &quot; as Name: &quot; + component.VO.Name);
         }
 
         public void Remove (IComponentModel component) {

Modified: ComponentModel/trunk/src/ComponentModel.Interfaces/IComponentModel.cs
===================================================================
--- ComponentModel/trunk/src/ComponentModel.Interfaces/IComponentModel.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/src/ComponentModel.Interfaces/IComponentModel.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -3,5 +3,7 @@
 namespace ComponentModel.Interfaces {
     public interface IComponentModel {
         ComponentModelVO VO {get;}
+
+        ResponseMethodVO Execute (string methodName, params object[] parameters);
     }
 }

Modified: ComponentModel/trunk/src/ComponentModel.Interfaces/IContainer.cs
===================================================================
--- ComponentModel/trunk/src/ComponentModel.Interfaces/IContainer.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/src/ComponentModel.Interfaces/IContainer.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -1,7 +1,9 @@
 using System;
+
 namespace ComponentModel.Interfaces {
     public interface IContainer {
         IComponentModel GetComponentByName (string componentName);
+        
         void Add (IComponentModel componentModel);
         void Remove (IComponentModel componentModel);
     }

Added: ComponentModel/trunk/src/ComponentModel.VO/ResponseMethodVO.cs
===================================================================
--- ComponentModel/trunk/src/ComponentModel.VO/ResponseMethodVO.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/src/ComponentModel.VO/ResponseMethodVO.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -0,0 +1,13 @@
+using System;
+
+namespace ComponentModel.VO {
+    public class ResponseMethodVO {
+        private object responseValue; 
+
+        public object ResponseValue {
+            get {return responseValue;}
+            set {responseValue = value;}
+        }
+
+    }
+}

Modified: ComponentModel/trunk/src/DefaultComponentModel.cs
===================================================================
--- ComponentModel/trunk/src/DefaultComponentModel.cs	2005-04-05 15:56:33 UTC (rev 401)
+++ ComponentModel/trunk/src/DefaultComponentModel.cs	2005-04-05 21:30:32 UTC (rev 402)
@@ -1,21 +1,73 @@
 using System;
+using System.Reflection;
 using ComponentModel.Interfaces;
 using ComponentModel.VO;
+using NLog;
+using ComponentModel.Container;
 
 namespace ComponentModel {
     public class DefaultComponentModel : IComponentModel {
+        //Logging
+        Logger logger = LogManager.GetLogger (&quot;ComponentModel.DefaultComponentModel&quot;);
         ComponentModelVO vO;
-
+        
+        //Properties
         public ComponentModelVO VO {
             get {return vO;}
         }
+        //Ctor
+        protected DefaultComponentModel () {
+            logger.Debug (&quot;Executing ctor for: &quot; + this.GetType ().FullName);
+        }
         
-        public DefaultComponentModel () {
+        public ResponseMethodVO Execute (string methodName, params object[] parameters) {
+            logger.Debug (&quot;Enter method Execute.&quot;);
+            Type type = this.GetType ();
+            logger.Debug (&quot;Type of component invoke: &quot; + type.ToString ());
+            ResponseMethodVO responseMethodVO = new ResponseMethodVO ();
+            // Solo se aceptan m&#233;todos no est&#225;ticos, declarados y p&#250;blicos.
+            MethodInfo methodInfo = type.GetMethod (methodName, BindingFlags.Instance | BindingFlags.DeclaredOnly | BindingFlags.Public);
+            logger.Debug (&quot;Finded method to execute: &quot; + methodInfo.ToString ());
+            //Cumple requisitos de ejecuci&#243;n?
+            Attribute[] attributes = (Attribute[])methodInfo.GetCustomAttributes (typeof (ComponentMethodAttribute),false);
+            if (attributes.Length == 1) {
+                ComponentMethodAttribute componentMethodAttribute = (ComponentMethodAttribute)attributes[0];
+                logger.Debug (&quot;Finded Attribute: &quot; + componentMethodAttribute.GetType ());
+                logger.Debug (&quot;Reading attribute viewName: &quot; + componentMethodAttribute.ViewName);
+                Type viewType = this.GetViewType (componentMethodAttribute);
+                logger.Debug (&quot;Finded view Type: &quot; + viewType.ToString ());
+                //Execute Method here !! 
+                object ret = methodInfo.Invoke (this, parameters);
+                responseMethodVO.ResponseValue = ret;
+                //Redirecting to view.
+                object obj = viewType.GetConstructor (null).Invoke (null);
+                methodInfo = viewType.GetMethod (componentMethodAttribute.ResponseName, BindingFlags.Instance | BindingFlags.DeclaredOnly | BindingFlags.Public);
+                //Executing response.
+                methodInfo.Invoke (obj, new object[]{responseMethodVO});
+                logger.Debug (&quot;Finded response Method in view: &quot; + viewType.ToString() + &quot; &quot; + methodInfo.ToString ());
+            }
+            logger.Debug (&quot;Exiting method Execute&quot;);
+            if (responseMethodVO.ResponseValue != null)
+                return responseMethodVO;
+            return null;
         }
-         
+
+        private Type GetViewType (ComponentMethodAttribute componentMethodAttribute) {
+            foreach (Assembly assembly in DefaultContainer.Instance.Assemblies) {
+                foreach (Type type in assembly.GetTypes ()) {
+                    if ((type.ToString ()).Equals (componentMethodAttribute.ViewName)) {
+                        logger.Debug (&quot;ViewType finded: &quot; + type.ToString ());
+                        return type;
+                    }
+                }
+            }
+            return null;
+        }
+        
+        //Other (Aux @DEPRECATED)
         internal void SetVO (ComponentModelVO vo) {
             this.vO = vo;
         }
-    
+         
     }
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000114.html">[Mspace-checkins] r401 - Red.ProjectManager/trunk
</A></li>
	<LI>Next message: <A HREF="000116.html">[Mspace-checkins] r403 - in ComponentModel/trunk: ComponentTest/src/Components/MainComponent ComponentTest/src/Components/MainComponent/Bo ComponentTest/src/Components/MainComponent/Exception ComponentTest/src/Components/Saludator/Bo ComponentTest/src/Components/Saludator/Exception src src/ComponentModel.Container src/ComponentModel.Exceptions src/ComponentModel.Interfaces src/ComponentModel.VO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#115">[ date ]</a>
              <a href="thread.html#115">[ thread ]</a>
              <a href="subject.html#115">[ subject ]</a>
              <a href="author.html#115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/mspace-checkins">More information about the Mspace-checkins
mailing list</a><br>
</body></html>
